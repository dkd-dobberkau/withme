<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TYPO3 with me</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --t3-orange: #FF8700;
    --t3-orange-light: #FFAA33;
    --t3-orange-glow: rgba(255, 135, 0, 0.4);
    --t3-dark: #1A1A2E;
    --t3-darker: #0F0F1A;
    --t3-surface: #222240;
    --t3-text: #E8E8F0;
    --t3-text-dim: #8888AA;
    --t3-accent: #4ECDC4;
    --t3-pulse: #FF4444;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Source Sans 3', sans-serif;
    background: var(--t3-darker);
    color: var(--t3-text);
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }

  /* ‚ïê‚ïê‚ïê Header ‚ïê‚ïê‚ïê */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 28px;
    background: linear-gradient(180deg, rgba(15,15,26,0.95) 0%, rgba(15,15,26,0.7) 80%, transparent 100%);
    backdrop-filter: blur(12px);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .logo-icon {
    width: 42px;
    height: 42px;
    background: var(--t3-orange);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 15px;
    color: #fff;
    box-shadow: 0 0 20px var(--t3-orange-glow);
    letter-spacing: -0.5px;
  }

  .logo-text {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
  }

  .logo-text span {
    color: var(--t3-orange);
  }

  .header-stats {
    display: flex;
    gap: 32px;
    align-items: center;
  }

  .stat {
    text-align: center;
  }

  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--t3-orange);
    line-height: 1;
  }

  .stat-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--t3-text-dim);
    margin-top: 4px;
  }

  .live-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 68, 68, 0.15);
    border: 1px solid rgba(255, 68, 68, 0.3);
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    color: var(--t3-pulse);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .live-dot {
    width: 8px;
    height: 8px;
    background: var(--t3-pulse);
    border-radius: 50%;
    animation: livePulse 1.5s ease-in-out infinite;
  }

  @keyframes livePulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.8); }
  }

  /* ‚ïê‚ïê‚ïê Map Container ‚ïê‚ïê‚ïê */
  .map-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
    background: var(--t3-darker);
  }

  .map-svg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  /* ‚ïê‚ïê‚ïê Installation Ping ‚ïê‚ïê‚ïê */
  .ping {
    position: absolute;
    pointer-events: none;
    z-index: 10;
  }

  .ping-dot {
    width: 8px;
    height: 8px;
    background: var(--t3-orange);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 12px var(--t3-orange-glow);
    z-index: 2;
  }

  .ping-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    border: 2px solid var(--t3-orange);
    border-radius: 50%;
    animation: pingExpand 2s ease-out forwards;
    opacity: 0;
  }

  .ping-ring:nth-child(2) { animation-delay: 0.3s; }
  .ping-ring:nth-child(3) { animation-delay: 0.6s; }

  @keyframes pingExpand {
    0% { width: 8px; height: 8px; opacity: 0.8; }
    100% { width: 80px; height: 80px; opacity: 0; }
  }

  /* ‚ïê‚ïê‚ïê Toast Notification ‚ïê‚ïê‚ïê */
  .toast-container {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 200;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }

  .toast {
    background: var(--t3-surface);
    border: 1px solid rgba(255, 135, 0, 0.25);
    border-radius: 14px;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: toastIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards,
               toastOut 0.4s ease-in 4s forwards;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,135,0,0.1);
    white-space: nowrap;
    backdrop-filter: blur(20px);
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(20px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateY(0) scale(1); }
    to { opacity: 0; transform: translateY(-10px) scale(0.95); }
  }

  .toast-icon {
    width: 32px;
    height: 32px;
    background: var(--t3-orange);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
  }

  .toast-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .toast-title {
    font-weight: 600;
    font-size: 14px;
    color: var(--t3-text);
  }

  .toast-detail {
    font-size: 12px;
    color: var(--t3-text-dim);
    font-family: 'JetBrains Mono', monospace;
  }

  .toast-version {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--t3-accent);
    background: rgba(78, 205, 196, 0.1);
    padding: 2px 8px;
    border-radius: 6px;
    margin-left: 8px;
    flex-shrink: 0;
  }

  /* ‚ïê‚ïê‚ïê Activity Feed ‚ïê‚ïê‚ïê */
  .feed {
    position: fixed;
    right: 20px;
    top: 90px;
    bottom: 100px;
    width: 320px;
    z-index: 50;
    display: flex;
    flex-direction: column;
    gap: 6px;
    overflow: hidden;
    mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 85%, transparent 100%);
  }

  .feed-item {
    background: rgba(34, 34, 64, 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 135, 0, 0.08);
    border-radius: 10px;
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: feedSlide 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    font-size: 13px;
    flex-shrink: 0;
  }

  @keyframes feedSlide {
    from { opacity: 0; transform: translateX(30px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .feed-dot {
    width: 6px;
    height: 6px;
    background: var(--t3-orange);
    border-radius: 50%;
    flex-shrink: 0;
  }

  .feed-city {
    font-weight: 600;
    flex: 1;
  }

  .feed-time {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--t3-text-dim);
  }

  .feed-ver {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--t3-accent);
    background: rgba(78, 205, 196, 0.08);
    padding: 2px 6px;
    border-radius: 4px;
  }

  /* ‚ïê‚ïê‚ïê Bottom Bar ‚ïê‚ïê‚ïê */
  .bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    padding: 16px 28px;
    background: linear-gradient(0deg, rgba(15,15,26,0.95) 0%, rgba(15,15,26,0.7) 80%, transparent 100%);
    backdrop-filter: blur(12px);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .version-chart {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    height: 40px;
  }

  .version-bar-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .version-bar {
    width: 28px;
    border-radius: 4px 4px 0 0;
    background: var(--t3-orange);
    transition: height 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .version-bar.v13 { opacity: 1; }
  .version-bar.v12 { opacity: 0.6; }
  .version-bar.v11 { opacity: 0.35; }

  .version-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--t3-text-dim);
  }

  .region-stats {
    display: flex;
    gap: 24px;
  }

  .region {
    text-align: center;
  }

  .region-name {
    font-size: 11px;
    color: var(--t3-text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .region-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    color: var(--t3-text);
  }

  .cta-button {
    background: var(--t3-orange);
    color: #fff;
    border: none;
    padding: 12px 28px;
    border-radius: 10px;
    font-family: 'Source Sans 3', sans-serif;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.3px;
    box-shadow: 0 4px 20px var(--t3-orange-glow);
    transition: all 0.2s ease;
  }

  .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 28px rgba(255, 135, 0, 0.5);
  }

  /* ‚ïê‚ïê‚ïê Existing installations (persistent dots) ‚ïê‚ïê‚ïê */
  .existing-dot {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--t3-orange);
    border-radius: 50%;
    opacity: 0.25;
    pointer-events: none;
  }

  /* ‚ïê‚ïê‚ïê Grid overlay ‚ïê‚ïê‚ïê */
  .grid-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0.03;
    background-image:
      linear-gradient(rgba(255,135,0,0.5) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,135,0,0.5) 1px, transparent 1px);
    background-size: 80px 80px;
  }

  /* ‚ïê‚ïê‚ïê Responsive ‚ïê‚ïê‚ïê */
  @media (max-width: 768px) {
    .feed { display: none; }
    .header-stats { gap: 16px; }
    .stat-value { font-size: 18px; }
    .region-stats { gap: 12px; }
    .header { padding: 12px 16px; }
    .bottom-bar { padding: 12px 16px; }
  }
</style>
</head>
<body>

<header class="header">
  <div class="logo">
    <div class="logo-icon">T3</div>
    <div class="logo-text"><span>TYPO3</span> with me</div>
  </div>
  <div class="header-stats">
    <div class="stat">
      <div class="stat-value" id="totalInstalls">12,847</div>
      <div class="stat-label">Installations today</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="activeNow">1,203</div>
      <div class="stat-label">Active right now</div>
    </div>
    <div class="live-badge">
      <div class="live-dot"></div>
      Live
    </div>
  </div>
</header>

<div class="map-container" id="mapContainer">
  <div class="grid-overlay"></div>
  <!-- World map SVG -->
  <svg class="map-svg" id="worldMap" viewBox="0 0 1200 620" preserveAspectRatio="xMidYMid meet">
    <defs>
      <radialGradient id="glow">
        <stop offset="0%" stop-color="#FF8700" stop-opacity="0.15"/>
        <stop offset="100%" stop-color="#FF8700" stop-opacity="0"/>
      </radialGradient>
      <!-- Europe glow -->
      <radialGradient id="euroGlow" cx="560" cy="200" r="120" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#FF8700" stop-opacity="0.12"/>
        <stop offset="100%" stop-color="#FF8700" stop-opacity="0"/>
      </radialGradient>
    </defs>

    <!-- Ocean background -->
    <rect fill="#0F0F1A" width="1200" height="620"/>

    <!-- Europe glow (TYPO3 heartland) -->
    <circle cx="560" cy="200" r="120" fill="url(#euroGlow)"/>

    <!-- Simplified world landmasses -->
    <!-- North America -->
    <path d="M120,120 L180,90 L240,95 L280,110 L310,130 L320,160 L300,200 L280,230 L260,260 L240,270 L200,280 L170,270 L150,250 L130,220 L110,180 L115,150 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Central America -->
    <path d="M200,280 L220,290 L230,310 L225,330 L210,340 L200,330 L195,310 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- South America -->
    <path d="M250,340 L280,330 L310,350 L320,390 L310,440 L290,490 L270,520 L250,530 L240,500 L235,460 L240,420 L235,380 L240,350 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Europe -->
    <path d="M480,130 L510,110 L540,105 L570,110 L600,120 L620,140 L630,170 L610,200 L590,210 L560,220 L530,230 L500,225 L485,210 L475,190 L470,170 L475,150 Z" fill="#222244" stroke="#3A3A60" stroke-width="0.5"/>
    <!-- UK/Ireland -->
    <path d="M470,140 L480,130 L485,145 L478,155 L472,150 Z" fill="#222244" stroke="#3A3A60" stroke-width="0.5"/>
    <!-- Scandinavia -->
    <path d="M530,70 L545,60 L555,75 L560,100 L550,110 L535,105 L530,85 Z" fill="#222244" stroke="#3A3A60" stroke-width="0.5"/>
    <!-- Africa -->
    <path d="M490,260 L530,250 L570,260 L590,290 L600,330 L590,380 L570,430 L540,460 L510,450 L490,420 L480,380 L470,340 L475,300 L480,270 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Russia/Asia -->
    <path d="M620,130 L680,100 L750,90 L830,95 L900,105 L950,120 L980,140 L960,170 L920,190 L870,200 L800,210 L730,200 L670,190 L640,170 L630,150 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Middle East -->
    <path d="M620,210 L650,200 L680,210 L690,240 L670,260 L640,260 L620,245 L615,225 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- India -->
    <path d="M720,230 L750,220 L770,240 L760,280 L740,310 L720,300 L710,270 L715,245 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- China/East Asia -->
    <path d="M800,170 L850,160 L900,170 L920,200 L900,230 L860,240 L820,235 L800,215 L795,190 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Japan -->
    <path d="M930,175 L940,165 L945,180 L940,195 L932,190 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Southeast Asia -->
    <path d="M830,270 L860,260 L890,275 L880,310 L860,330 L835,320 L825,295 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>
    <!-- Australia -->
    <path d="M870,400 L920,380 L970,390 L990,420 L980,460 L950,480 L910,475 L880,450 L870,420 Z" fill="#1E1E38" stroke="#2A2A50" stroke-width="0.5"/>

    <!-- Connection lines (subtle arcs between TYPO3 hubs) -->
    <g class="connections" opacity="0.06" stroke="#FF8700" fill="none" stroke-width="0.5">
      <path d="M555,180 Q450,100 250,180"/>
      <path d="M555,180 Q650,120 870,200"/>
      <path d="M555,180 Q560,300 530,420"/>
      <path d="M555,180 Q700,150 930,180"/>
      <path d="M555,180 Q680,350 920,430"/>
    </g>
  </svg>

  <div id="pingsLayer"></div>
  <div id="existingDots"></div>
</div>

<div class="feed" id="activityFeed"></div>
<div class="toast-container" id="toastContainer"></div>

<div class="bottom-bar">
  <div class="version-chart">
    <div class="version-bar-wrap">
      <div class="version-bar v11" id="barV11" style="height:10px"></div>
      <span class="version-label">v11</span>
    </div>
    <div class="version-bar-wrap">
      <div class="version-bar v12" id="barV12" style="height:20px"></div>
      <span class="version-label">v12</span>
    </div>
    <div class="version-bar-wrap">
      <div class="version-bar v13" id="barV13" style="height:35px"></div>
      <span class="version-label">v13</span>
    </div>
  </div>

  <div class="region-stats">
    <div class="region">
      <div class="region-count" id="regionEU">8,421</div>
      <div class="region-name">Europe</div>
    </div>
    <div class="region">
      <div class="region-count" id="regionNA">2,103</div>
      <div class="region-name">Americas</div>
    </div>
    <div class="region">
      <div class="region-count" id="regionAP">1,846</div>
      <div class="region-name">Asia-Pacific</div>
    </div>
    <div class="region">
      <div class="region-count" id="regionOT">477</div>
      <div class="region-name">Other</div>
    </div>
  </div>

  <button class="cta-button" onclick="window.open('https://get.typo3.org','_blank')">
    Install TYPO3 Now
  </button>
</div>

<script>
// ‚ïê‚ïê‚ïê City Database with approximate map coordinates (x%, y%) ‚ïê‚ïê‚ïê
const cities = [
  // Europe - Dense (TYPO3 heartland)
  { name: "Frankfurt", country: "DE", x: 47.5, y: 30.5, region: "EU" },
  { name: "Berlin", country: "DE", x: 48.5, y: 27, region: "EU" },
  { name: "M√ºnchen", country: "DE", x: 48, y: 32, region: "EU" },
  { name: "Hamburg", country: "DE", x: 47, y: 26, region: "EU" },
  { name: "D√ºsseldorf", country: "DE", x: 45.5, y: 29.5, region: "EU" },
  { name: "Stuttgart", country: "DE", x: 46.5, y: 32, region: "EU" },
  { name: "K√∂ln", country: "DE", x: 45.5, y: 30, region: "EU" },
  { name: "Leipzig", country: "DE", x: 48.5, y: 29, region: "EU" },
  { name: "Dresden", country: "DE", x: 49.5, y: 29, region: "EU" },
  { name: "Freiburg", country: "DE", x: 45.8, y: 33, region: "EU" },
  { name: "Wien", country: "AT", x: 50.5, y: 32, region: "EU" },
  { name: "Z√ºrich", country: "CH", x: 46, y: 33, region: "EU" },
  { name: "Bern", country: "CH", x: 45.5, y: 33.5, region: "EU" },
  { name: "Amsterdam", country: "NL", x: 44.5, y: 27, region: "EU" },
  { name: "Rotterdam", country: "NL", x: 44, y: 28, region: "EU" },
  { name: "Copenhagen", country: "DK", x: 48, y: 24, region: "EU" },
  { name: "Aarhus", country: "DK", x: 47, y: 23.5, region: "EU" },
  { name: "Stockholm", country: "SE", x: 50, y: 20, region: "EU" },
  { name: "Oslo", country: "NO", x: 47, y: 20, region: "EU" },
  { name: "Helsinki", country: "FI", x: 53, y: 19, region: "EU" },
  { name: "Paris", country: "FR", x: 43, y: 32, region: "EU" },
  { name: "Lyon", country: "FR", x: 44, y: 35, region: "EU" },
  { name: "Bruxelles", country: "BE", x: 44, y: 29, region: "EU" },
  { name: "London", country: "GB", x: 41, y: 27.5, region: "EU" },
  { name: "Manchester", country: "GB", x: 40.5, y: 26, region: "EU" },
  { name: "Praha", country: "CZ", x: 49.5, y: 30, region: "EU" },
  { name: "Warszawa", country: "PL", x: 52, y: 27, region: "EU" },
  { name: "Milano", country: "IT", x: 46.5, y: 35, region: "EU" },
  { name: "Roma", country: "IT", x: 48, y: 38, region: "EU" },
  { name: "Barcelona", country: "ES", x: 43, y: 38, region: "EU" },
  { name: "Madrid", country: "ES", x: 41, y: 38, region: "EU" },
  { name: "Lisboa", country: "PT", x: 38, y: 39, region: "EU" },
  { name: "Budapest", country: "HU", x: 51, y: 33, region: "EU" },
  { name: "Bratislava", country: "SK", x: 50.5, y: 32.5, region: "EU" },
  { name: "Paderborn", country: "DE", x: 46.5, y: 28.5, region: "EU" },
  // Americas
  { name: "New York", country: "US", x: 25, y: 32, region: "NA" },
  { name: "San Francisco", country: "US", x: 13, y: 34, region: "NA" },
  { name: "Los Angeles", country: "US", x: 14, y: 37, region: "NA" },
  { name: "Chicago", country: "US", x: 21, y: 31, region: "NA" },
  { name: "Toronto", country: "CA", x: 23, y: 28, region: "NA" },
  { name: "Vancouver", country: "CA", x: 13, y: 26, region: "NA" },
  { name: "S√£o Paulo", country: "BR", x: 26, y: 70, region: "NA" },
  { name: "Buenos Aires", country: "AR", x: 23, y: 78, region: "NA" },
  { name: "Mexico City", country: "MX", x: 17, y: 47, region: "NA" },
  { name: "Bogot√°", country: "CO", x: 21, y: 54, region: "NA" },
  // Asia-Pacific
  { name: "Tokyo", country: "JP", x: 80, y: 31, region: "AP" },
  { name: "Shanghai", country: "CN", x: 75, y: 35, region: "AP" },
  { name: "Beijing", country: "CN", x: 73, y: 30, region: "AP" },
  { name: "Seoul", country: "KR", x: 77, y: 31, region: "AP" },
  { name: "Singapore", country: "SG", x: 72, y: 52, region: "AP" },
  { name: "Sydney", country: "AU", x: 83, y: 72, region: "AP" },
  { name: "Melbourne", country: "AU", x: 81, y: 75, region: "AP" },
  { name: "Mumbai", country: "IN", x: 63, y: 45, region: "AP" },
  { name: "Bangalore", country: "IN", x: 64, y: 49, region: "AP" },
  { name: "Bangkok", country: "TH", x: 71, y: 47, region: "AP" },
  // Middle East / Africa
  { name: "Dubai", country: "AE", x: 59, y: 42, region: "OT" },
  { name: "Abu Dhabi", country: "AE", x: 58.5, y: 42.5, region: "OT" },
  { name: "Istanbul", country: "TR", x: 54, y: 33, region: "OT" },
  { name: "Tel Aviv", country: "IL", x: 55, y: 38, region: "OT" },
  { name: "Cape Town", country: "ZA", x: 50, y: 72, region: "OT" },
  { name: "Nairobi", country: "KE", x: 56, y: 52, region: "OT" },
];

const versions = ["v13.4", "v13.3", "v13.2", "v12.4", "v12.3", "v11.5"];
const versionWeights = [40, 25, 10, 15, 7, 3]; // Probability weights

function pickVersion() {
  const total = versionWeights.reduce((a, b) => a + b, 0);
  let r = Math.random() * total;
  for (let i = 0; i < versions.length; i++) {
    r -= versionWeights[i];
    if (r <= 0) return versions[i];
  }
  return versions[0];
}

function pickCity() {
  // Weight heavily towards Europe
  const r = Math.random();
  const euCities = cities.filter(c => c.region === "EU");
  const otherCities = cities.filter(c => c.region !== "EU");
  if (r < 0.65) return euCities[Math.floor(Math.random() * euCities.length)];
  return otherCities[Math.floor(Math.random() * otherCities.length)];
}

// ‚ïê‚ïê‚ïê Counters ‚ïê‚ïê‚ïê
let totalCount = 12847;
let activeCount = 1203;
let regionCounts = { EU: 8421, NA: 2103, AP: 1846, OT: 477 };
let versionCounts = { v11: 312, v12: 546, v13: 1890 };

function updateCounters(city, version) {
  totalCount++;
  document.getElementById('totalInstalls').textContent = totalCount.toLocaleString();

  if (Math.random() > 0.5) {
    activeCount += Math.random() > 0.7 ? 1 : -1;
    activeCount = Math.max(1100, activeCount);
    document.getElementById('activeNow').textContent = activeCount.toLocaleString();
  }

  regionCounts[city.region]++;
  document.getElementById('regionEU').textContent = regionCounts.EU.toLocaleString();
  document.getElementById('regionNA').textContent = regionCounts.NA.toLocaleString();
  document.getElementById('regionAP').textContent = regionCounts.AP.toLocaleString();
  document.getElementById('regionOT').textContent = regionCounts.OT.toLocaleString();

  const vKey = version.startsWith('v13') ? 'v13' : version.startsWith('v12') ? 'v12' : 'v11';
  versionCounts[vKey]++;
  const maxV = Math.max(versionCounts.v11, versionCounts.v12, versionCounts.v13);
  document.getElementById('barV11').style.height = (versionCounts.v11 / maxV * 35) + 'px';
  document.getElementById('barV12').style.height = (versionCounts.v12 / maxV * 35) + 'px';
  document.getElementById('barV13').style.height = (versionCounts.v13 / maxV * 35) + 'px';
}

// ‚ïê‚ïê‚ïê Create Ping on Map ‚ïê‚ïê‚ïê
function createPing(city) {
  const container = document.getElementById('pingsLayer');
  const ping = document.createElement('div');
  ping.className = 'ping';
  ping.style.left = city.x + '%';
  ping.style.top = city.y + '%';
  ping.innerHTML = `
    <div class="ping-ring"></div>
    <div class="ping-ring"></div>
    <div class="ping-ring"></div>
    <div class="ping-dot"></div>
  `;
  container.appendChild(ping);
  setTimeout(() => ping.remove(), 3000);
}

// ‚ïê‚ïê‚ïê Toast Notification ‚ïê‚ïê‚ïê
function showToast(city, version) {
  const container = document.getElementById('toastContainer');
  // Max 2 toasts
  while (container.children.length >= 2) {
    container.firstChild.remove();
  }

  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-icon">üöÄ</div>
    <div class="toast-content">
      <div class="toast-title">New Installation in ${city.name}</div>
      <div class="toast-detail">${city.country} ¬∑ just now</div>
    </div>
    <div class="toast-version">${version}</div>
  `;
  container.appendChild(toast);
  setTimeout(() => { if (toast.parentNode) toast.remove(); }, 5000);
}

// ‚ïê‚ïê‚ïê Activity Feed ‚ïê‚ïê‚ïê
function addFeedItem(city, version) {
  const feed = document.getElementById('activityFeed');
  const item = document.createElement('div');
  item.className = 'feed-item';

  const now = new Date();
  const timeStr = now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

  item.innerHTML = `
    <div class="feed-dot"></div>
    <div class="feed-city">${city.name}, ${city.country}</div>
    <div class="feed-ver">${version}</div>
    <div class="feed-time">${timeStr}</div>
  `;

  feed.insertBefore(item, feed.firstChild);

  // Keep max 30 items
  while (feed.children.length > 30) {
    feed.lastChild.remove();
  }
}

// ‚ïê‚ïê‚ïê Seed existing installations ‚ïê‚ïê‚ïê
function seedExistingDots() {
  const container = document.getElementById('existingDots');
  for (let i = 0; i < 200; i++) {
    const city = pickCity();
    const dot = document.createElement('div');
    dot.className = 'existing-dot';
    const offsetX = (Math.random() - 0.5) * 4;
    const offsetY = (Math.random() - 0.5) * 4;
    dot.style.left = (city.x + offsetX) + '%';
    dot.style.top = (city.y + offsetY) + '%';
    dot.style.opacity = 0.1 + Math.random() * 0.2;
    container.appendChild(dot);
  }
}

// ‚ïê‚ïê‚ïê Simulate a new installation ‚ïê‚ïê‚ïê
function simulateInstall() {
  const city = pickCity();
  const version = pickVersion();

  createPing(city);
  showToast(city, version);
  addFeedItem(city, version);
  updateCounters(city, version);
}

// ‚ïê‚ïê‚ïê Initialize ‚ïê‚ïê‚ïê
seedExistingDots();

// Seed a few feed items
for (let i = 0; i < 8; i++) {
  const city = pickCity();
  const version = pickVersion();
  addFeedItem(city, version);
}

// Simulate installations at random intervals (2-8 seconds)
function scheduleNext() {
  const delay = 2000 + Math.random() * 6000;
  setTimeout(() => {
    simulateInstall();
    scheduleNext();
  }, delay);
}

// Start with a quick burst
setTimeout(simulateInstall, 1500);
setTimeout(simulateInstall, 3000);
scheduleNext();
</script>

</body>
</html>
